// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// USUÁRIOS DO SISTEMA
// ============================================
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  role      String   @default("USER") // ADMIN, USER
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ============================================
// PESSOAS (Principal)
// ============================================
model Person {
  id                      Int      @id @default(autoincrement())
  nome                    String
  cpf                     String   @unique
  rg                      String?
  dataNascimento          String?
  endereco                String?
  cargo                   String
  formacao                String?
  
  status                  String   @default("ativo") // ativo, inativo, banco_de_dados, baixa_frequencia
  
  // Contato
  email                   String
  telefone                String
  
  // Empresa e Contrato
  empresa                 String
  contrato                String   @default("CONTRATO GLOBAL") // Contrato principal
  contratosAtivos         String[] // DEPRECATED: Usar relation contratosDetalhados
  contratosDetalhados     PersonContract[] // Relation to contracts
  
  dataAdmissao            String?
  vigenciaInicio          String?
  vigenciaFim             String?
  termoConfidencialidade  Boolean  @default(false)
  
  // Documentação PJ
  apresentouCartaoCnpj    Boolean  @default(false)
  numeroCnpj              String?
  
  // Conselho de Classe
  conselhoClasse          String?
  anoRegistroConselho     String?
  numeroRegistroConselho  String?
  certidaoQuitacaoPf      Boolean  @default(false)
  certidaoQuitacaoPj      Boolean  @default(false)
  certidaoQuitacaoData    String?  // Data da certidão
  certidaoQuitacaoStatus  String?  // vigente, vencido, na
  
  // Profissional
  curriculo               Boolean  @default(false)
  historicoProfissional   String?
  treinamentos            String[] // Array de treinamentos
  
  // Áreas e Disciplinas
  areas                   String[] // Array: rodovia, ferrovia, etc.
  areasDetalhes           Json?    // { "rodovia": ["PROJETO"], "ferrovia": ["OBRA", "PROJETO"] }
  
  // Deprecated Global Flags (Mantendo para histórico)
  disciplina              String   @default("PROJETO")
  atuacaoProjeto          Boolean  @default(false)
  atuacaoObra             Boolean  @default(false)
  
  competencias            String[] // Array de competencias
  disciplinasProjeto      String[] // Array
  disciplinasObra         String[] // Array
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
}

// ============================================
// CONTRATOS DETALHADOS (Eixo 1, Entrevias, etc.)
// ============================================
model PersonContract {
  id        Int      @id @default(autoincrement())
  tipo      String   // EIXO 1, ENTREVIAS, ECOPISTAS, ECORIOMINAS, CONTRATO GLOBAL
  nome      String   // Ex: CT. 0075/23 OS - 026
  data      String   // Ex: 24/11/2023
  
  personId  Int
  person    Person   @relation(fields: [personId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


// ============================================
// CONFIGURAÇÕES (Dropdowns)
// ============================================
model Setting {
  id        Int      @id @default(autoincrement())
  category  String   // empresas, contratos, disciplinasProjeto, disciplinasObra, areas, treinamentos, clientes
  value     String
  label     String?  // Para áreas que têm label diferente do value
  createdAt DateTime @default(now())
  
  @@unique([category, value])
}

// ============================================
// ORDENS DE SERVIÇO
// ============================================
model OrdemServico {
  id              Int      @id @default(autoincrement())
  contrato        String   // Ex: "0042.23"
  dataContrato    String   // Ex: "13/09/2023"
  ordemServico    String   // Ex: "012"
  dataOrdemServico String  // Ex: "01/12/2023"
  nome            String   // Ex: "Mônica Gislaine Haenel"
  cliente         String   // Ex: "Ecopistas 1" - vem do dropdown de clientes
  valorNegociado  Float    // Ex: 120.00
  status          String   @default("ativo") // ativo, apagado
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}
